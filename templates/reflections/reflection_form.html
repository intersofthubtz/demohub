{% extends "base.html" %}
{% load static %}

{% block title %}{{ edit|default_if_none:"Add" }} Reflection{% endblock %}

{% block content %}
<div class="p-6 max-w-7xl mx-auto space-y-6">

  <!-- ================= BREADCRUMB + PAGE TITLE ================= -->
  <div class="flex justify-between items-center mb-4">
    <!-- Breadcrumb left -->
    <nav class="text-lg text-gray-600" aria-label="Breadcrumb">
      <ol class="list-reset flex">
        <li>
          <a href="{% url 'reflections:reflection_list' %}" class="hover:underline">Reflections</a>
        </li>
        <li><span class="mx-2">â†’</span></li>
        <li class="text-gray-800 font-semibold">
          {% if edit %}Edit{% else %}Add{% endif %}
        </li>
      </ol>
    </nav>

    <!-- Page Title right -->
    <h1 class="text-2xl font-semibold text-[#0F5391]">
      {% if edit %}Edit Reflection{% else %}Add Reflection{% endif %}
    </h1>
  </div>

  <!-- Success / Error messages -->
  {% if messages %}
    <div id="messages" class="space-y-2 mb-4">
      {% for message in messages %}
        <div class="px-4 py-2 rounded text-sm font-semibold
          {% if message.tags == 'error' %}bg-red-100 text-red-700
          {% else %}bg-green-100 text-green-700{% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    </div>

    <script>
      setTimeout(() => {
        const msgDiv = document.getElementById("messages");
        if(msgDiv) msgDiv.style.display = "none";
      }, 4000);
    </script>
  {% endif %}

  <!-- ================= FORM ================= -->
  <div class="bg-white p-6 rounded shadow w-full space-y-4">

    <form id="reflection-form" method="POST" enctype="multipart/form-data" class="space-y-4">
      {% csrf_token %}
      {{ form.as_p }}

      <!-- IMAGE PREVIEW -->
      <img id="preview" class="mt-3 w-40 rounded shadow hidden">

      <!-- Bottom Save / Cancel Buttons -->
      <div class="flex justify-end gap-2 mt-4">
        <button type="submit"
                class="px-4 py-2 bg-[#0F5391] text-white rounded hover:bg-blue-800">
          Save
        </button>

        <a href="{% url 'reflections:reflection_list' %}"
           class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">
          Cancel
        </a>
      </div>
    </form>

  </div>

</div>

<!-- JS for image preview -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const input = document.querySelector("input[type='file']");
  const preview = document.getElementById("preview");

  if (input) {
    input.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) {
        preview.src = URL.createObjectURL(file);
        preview.classList.remove("hidden");
      }
    });
  }
});
</script>
{% endblock %}
